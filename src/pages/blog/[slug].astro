---
/**
 * Blog Post Page - Reading Mode
 *
 * Minimal layout focused on readability.
 */
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import BlogEditor from '../../components/BlogEditor';

const isDev = import.meta.env.DEV;

export async function getStaticPaths() {
  const posts = await getCollection('blog', ({ data }) => {
    return import.meta.env.PROD ? !data.draft : true;
  });

  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post }
  }));
}

interface Props {
  post: Awaited<ReturnType<typeof getCollection<'blog'>>>[number];
}

const { post } = Astro.props;
const { Content } = await post.render();

function formatDate(date: Date): string {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}
---

<Layout
  title={`${post.data.title} - AnswerLayer`}
  description={post.data.description}
  minimal={true}
>
  <article class="blog-post">
    <div class="reading-container">

      <!-- Minimal header -->
      <nav class="reading-nav">
        <a href="/" class="site-link">AnswerLayer</a>
        <span class="nav-sep">/</span>
        <a href="/blog" class="blog-link">Blog</a>
      </nav>

      <!-- Post header -->
      <header class="post-header">
        <time datetime={post.data.publishedAt.toISOString()} class="post-date">
          {formatDate(post.data.publishedAt)}
        </time>
        {post.data.draft && <span class="draft-badge">Draft</span>}
        <h1 class="post-title">{post.data.title}</h1>
        <p class="post-description">{post.data.description}</p>
        <span class="post-author">{post.data.author}</span>
      </header>

      <!-- Post content -->
      <div class="post-content">
        <Content />
      </div>

      <!-- Minimal footer -->
      <footer class="reading-footer">
        <a href="/blog" class="back-link">‚Üê More posts</a>
      </footer>

    </div>
  </article>

  {isDev && <BlogEditor slug={post.slug} client:only="react" />}
</Layout>

<style>
  .blog-post {
    min-height: 100vh;
    background: var(--color-background);
  }

  .reading-container {
    max-width: 1000px;
    margin: 0 auto;
    padding: 2rem 1.5rem 4rem;
  }

  /* Navigation */
  .reading-nav {
    margin-bottom: 3rem;
    font-family: var(--font-mono);
    font-size: 0.8125rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .site-link,
  .blog-link {
    color: var(--color-navy-600);
    text-decoration: none;
  }

  .site-link:hover,
  .blog-link:hover {
    color: var(--color-navy-900);
  }

  .nav-sep {
    color: var(--color-navy-400);
    margin: 0 0.5rem;
  }

  /* Header */
  .post-header {
    margin-bottom: 3rem;
  }

  .post-date {
    display: block;
    font-family: var(--font-mono);
    font-size: 0.75rem;
    color: var(--color-navy-500);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 1.5rem;
  }

  .draft-badge {
    display: inline-block;
    font-family: var(--font-mono);
    font-size: 0.625rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    padding: 0.25rem 0.5rem;
    color: #b45309;
    border: 1px solid #b45309;
    background: #fef3c7;
    margin-left: 1rem;
    vertical-align: middle;
  }

  .post-title {
    font-family: var(--font-body);
    font-size: 2.25rem;
    font-weight: 600;
    color: var(--color-navy-900);
    margin: 0 0 1rem 0;
    line-height: 1.25;
    letter-spacing: -0.02em;
    text-transform: none;
  }

  .post-description {
    font-family: var(--font-body);
    font-size: 2rem;
    color: var(--color-navy-300);
    line-height: 1.6;
    margin: 0 0 1rem 0;
    font-weight: 300;
  }

  .post-author {
    font-family: var(--font-mono);
    font-size: 0.75rem;
    color: var(--color-navy-500);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  /* Content */
  .post-content {
    font-family: var(--font-body);
    color: var(--color-navy-800);
    line-height: 1.85;
  }

  .post-content :global(p) {
    font-family: var(--font-body);
    font-size: 1.8rem;
    margin-bottom: 1.75rem;
  }

  .post-content :global(h2) {
    font-family: var(--font-display);
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--color-navy-900);
    margin: 3rem 0 1.25rem 0;
    line-height: 1.3;
  }

  .post-content :global(h3) {
    font-family: var(--font-display);
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--color-navy-900);
    margin: 2.5rem 0 1rem 0;
    line-height: 1.4;
  }

  .post-content :global(strong) {
    color: var(--color-navy-900);
    font-weight: 600;
  }

  .post-content :global(a) {
    color: var(--color-navy-700);
    text-decoration: underline;
    text-underline-offset: 2px;
  }

  .post-content :global(a:hover) {
    color: var(--color-navy-900);
  }

  .post-content :global(code) {
    font-family: var(--font-mono);
    font-size: 0.875em;
    background: var(--color-navy-100);
    padding: 0.125rem 0.375rem;
    color: var(--color-navy-800);
  }

  .post-content :global(pre) {
    background: var(--color-navy-900);
    color: var(--color-navy-100);
    padding: 1.25rem;
    margin: 2rem 0;
    overflow-x: auto;
    font-family: var(--font-mono);
    font-size: 0.875rem;
    line-height: 1.6;
  }

  .post-content :global(pre code) {
    background: transparent;
    padding: 0;
    color: inherit;
    font-size: inherit;
  }

  .post-content :global(ul),
  .post-content :global(ol) {
    margin: 1.75rem 0;
    padding-left: 1.25rem;
  }

  .post-content :global(li) {
    margin-bottom: 0.625rem;
  }

  .post-content :global(blockquote) {
    border-left: 2px solid var(--color-navy-300);
    padding-left: 1.25rem;
    margin: 2rem 0;
    font-style: italic;
    color: var(--color-navy-600);
  }

  .post-content :global(hr) {
    border: none;
    border-top: 1px solid var(--color-navy-200);
    margin: 3rem 0;
  }

  /* Footer */
  .reading-footer {
    margin-top: 4rem;
    padding-top: 2rem;
    border-top: 1px solid var(--color-navy-200);
  }

  .back-link {
    font-family: var(--font-mono);
    font-size: 0.8125rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    color: var(--color-navy-600);
    text-decoration: none;
  }

  .back-link:hover {
    color: var(--color-navy-900);
  }

  @media (min-width: 640px) {
    .reading-container {
      padding: 3rem 2rem 6rem;
    }

    .post-title {
      font-size: 2.75rem;
    }
  }

  /* Lighter scanlines for reading mode */
  :global(.scanline-overlay) {
    opacity: 0.5;
  }
</style>
